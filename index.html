<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RoadScore</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: #f4f6f8;
    margin: 0;
    padding: 0;
    color: #1d1d1d;
}
header {
    text-align: center;
    padding: 20px;
    background: white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}
h1 { font-size: 32px; color: #333; margin-bottom: 5px; }
h3 { margin-top: 25px; color: #333; }
form, #reports-list {
    background: white;
    padding: 20px;
    width: 90%;
    max-width: 900px;
    margin: 0 auto 20px auto;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
}
label { font-weight: bold; display: block; margin-top: 10px; margin-bottom: 4px; }
select, textarea, input[type="file"] { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 10px; font-size: 15px; }
#submit-btn {
    background: #2563eb;
    padding: 12px 20px;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: 0.2s;
    margin-top: 10px;
}
#submit-btn:hover:enabled { background: #1e4fcc; }
#submit-btn:disabled { opacity: 0.5; cursor: not-allowed; }
#map { border-radius: 12px; overflow: hidden; border: 2px solid #ddd; margin-top: 10px; height: 500px; }
@media (max-width: 1100px){ #map{height:300px;} }
.report-item { background:#fafafa; padding:15px; border-radius:10px; margin-bottom:15px; border-left:5px solid #2563eb; box-shadow:0 2px 5px rgba(0,0,0,0.05);}
.report-item img, .popup-img { max-width:120px; max-height:120px; border-radius:6px; margin-top:5px; display:block; }
.badge { padding:4px 10px; border-radius:6px; font-size:14px; color:white; margin-bottom:8px; display:inline-block; }
.b0{background:#444;} .b1{background:#d00000;} .b2{background:#e85d04;} .b3{background:#ffba08; color:black;} .b4{background:#0ead69;} .b5{background:#0077b6;}
</style>
</head>

<body>

<header>
<h1>RoadScore</h1>
<p>Rate the quality of the road.</p>
</header>

<form id="report-form">
<h3>1. Report Details</h3>

<label>Rating:</label>
<select id="category" required>
<option value="">-- Select Rating --</option>
<option value="0">0 - Unusable</option>
<option value="1">⭐ - Very Poor</option>
<option value="2">⭐⭐ - Poor</option>
<option value="3">⭐⭐⭐ - Average</option>
<option value="4">⭐⭐⭐⭐ - Good</option>
<option value="5">⭐⭐⭐⭐⭐ - Excellent</option>
</select>

<label>Description:</label>
<textarea id="description" rows="3" placeholder="What is wrong with the road?"></textarea>

<label>Attach Photo (Optional):</label>
<input type="file" id="imageInput" accept="image/*">

<h3>2. Pin Location (Click the map)</h3>
<div id="map"></div>

<button type="submit" id="submit-btn" disabled>Submit Report</button>
<span id="status-msg"></span>
</form>

<div id="reports-list">
<p>No reports yet.</p>
</div>

<script>
function getStars(rate){ const stars=["❌","⭐","⭐⭐","⭐⭐⭐","⭐⭐⭐⭐","⭐⭐⭐⭐⭐"]; return stars[rate]; }

var map, tempMarker=null, selectedLat=null, selectedLng=null;

var streetLayer=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19});
var satelliteLayer=L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',{maxZoom:19});

var layer0=L.layerGroup(), layer1=L.layerGroup(), layer2=L.layerGroup(), layer3=L.layerGroup(), layer4=L.layerGroup(), layer5=L.layerGroup();

map=L.map('map',{center:[8.36,124.86], zoom:13, layers:[streetLayer,layer0,layer1,layer2,layer3,layer4,layer5]});

L.control.layers(
{ "Street View": streetLayer, "Satellite View": satelliteLayer },
{ "0 - Unusable": layer0, "⭐ - Very Poor": layer1, "⭐⭐ - Poor": layer2, "⭐⭐⭐ - Average": layer3, "⭐⭐⭐⭐ - Good": layer4, "⭐⭐⭐⭐⭐ - Excellent": layer5 }
).addTo(map);

map.on('click',function(e){
    selectedLat=e.latlng.lat; selectedLng=e.latlng.lng;
    if(tempMarker) map.removeLayer(tempMarker);
    tempMarker=L.marker([selectedLat,selectedLng]).addTo(map);
    tempMarker.bindPopup("Selected Location").openPopup();
    document.getElementById('submit-btn').disabled=false;
    document.getElementById('status-msg').innerText="Location ready!";
    document.getElementById('status-msg').style.color="green";
});

document.getElementById('report-form').addEventListener('submit',function(e){
    e.preventDefault();
    var category=document.getElementById('category').value;
    var desc=document.getElementById('description').value;
    var imageFile=document.getElementById('imageInput').files[0];

    if(!selectedLat||!selectedLng){ alert("Please pin a location first."); return; }

    var targetLayer=[layer0,layer1,layer2,layer3,layer4,layer5][category];

    let imgURL="";
    if(imageFile) imgURL=URL.createObjectURL(imageFile);

    var finalMarker=L.marker([selectedLat,selectedLng]).addTo(targetLayer);

    let popupHTML=`<b>${getStars(category)}</b><br>${desc}<br>`;
    if(imgURL) popupHTML+=`<br><img src="${imgURL}" class="popup-img">`;
    finalMarker.bindPopup(popupHTML).openPopup();

    var list=document.getElementById('reports-list');
    if(list.innerHTML.includes("No reports yet")) list.innerHTML="";

    let item=document.createElement("div"); item.className="report-item";
    item.innerHTML=`<strong>${getStars(category)}</strong>
    <span style="color:#666">(${new Date().toLocaleTimeString()})</span><br>
    ${desc}<br>
    ${imgURL?`<img src="${imgURL}">`: ""}
    <br><small>Lat: ${selectedLat.toFixed(4)}, Lng: ${selectedLng.toFixed(4)}</small>`;
    list.prepend(item);

    document.getElementById("imageInput").value="";
    document.getElementById("submit-btn").disabled=true;
    document.getElementById("status-msg").innerText="";
    if(tempMarker) map.removeLayer(tempMarker);
    selectedLat=null; selectedLng=null;
    alert("Report Submitted!");
});
</script>

</body>
</html>
